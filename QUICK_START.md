# Quick Start - Security Features

## ğŸ›¡ï¸ å·²å®æ–½çš„å®‰å…¨æªæ–½

### 1. è¯·æ±‚é¢‘ç‡é™åˆ¶ (Rate Limiting)

- **é»˜è®¤é™åˆ¶**: æ¯ä¸ª IP æ¯åˆ†é’Ÿæœ€å¤š 10 ä¸ªè¯·æ±‚
- **è¶…é™æƒ©ç½š**: è‡ªåŠ¨å°é” IP 15 åˆ†é’Ÿ
- **ä¿æŠ¤ç›®æ ‡**: é˜²æ­¢æ¶æ„åˆ·è¯·æ±‚æ¶ˆè€— API ä½™é¢

### 2. æ¶ˆæ¯éªŒè¯ (Message Validation)

- **å•æ¡æ¶ˆæ¯**: æœ€å¤š 5000 å­—ç¬¦
- **å†å²è®°å½•**: æœ€å¤š 20 æ¡æ¶ˆæ¯
- **å†…å®¹æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«åƒåœ¾å†…å®¹å’Œé‡å¤å­—ç¬¦

### 3. ä½¿ç”¨é‡ç›‘æ§ (Usage Monitoring)

- **å®æ—¶ç»Ÿè®¡**: æ¯æ—¥è¯·æ±‚æ•°ã€Token ä¼°ç®—ã€ç‹¬ç«‹ IP æ•°
- **æ—¥å¿—è®°å½•**: ä¿å­˜åœ¨ `logs/` æ–‡ä»¶å¤¹
- **å¼‚å¸¸è­¦æŠ¥**: è‡ªåŠ¨è®°å½•å¯ç–‘æ´»åŠ¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
npm start
```

### 2. æµ‹è¯•å®‰å…¨åŠŸèƒ½

```bash
node test-security.js
```

### 3. æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡

```bash
curl http://localhost:3000/admin/stats
```

## ğŸ“Š ç®¡ç†æ¥å£

### æŸ¥çœ‹ä»Šæ—¥ç»Ÿè®¡

```bash
GET http://localhost:3000/admin/stats
```

### æŸ¥çœ‹è¢«å°é”çš„ IP

```bash
GET http://localhost:3000/admin/blocked-ips
```

### æ‰‹åŠ¨å°é” IP

```bash
POST http://localhost:3000/admin/block-ip
Content-Type: application/json

{
  "ip": "192.168.1.100",
  "durationMs": 3600000
}
```

### è§£å° IP

```bash
POST http://localhost:3000/admin/unblock-ip
Content-Type: application/json

{
  "ip": "192.168.1.100"
}
```

### è°ƒæ•´é™åˆ¶é…ç½®

```bash
POST http://localhost:3000/admin/config
Content-Type: application/json

{
  "maxRequests": 20,
  "windowMs": 60000,
  "blockDuration": 900000
}
```

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

ç¼–è¾‘ `config/security.config.js`:

```javascript
module.exports = {
  rateLimit: {
    windowMs: 60 * 1000, // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰
    maxRequests: 10, // çª—å£å†…æœ€å¤§è¯·æ±‚æ•°
    blockDuration: 15 * 60 * 1000, // å°é”æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
  },
  message: {
    maxMessageLength: 5000, // å•æ¡æ¶ˆæ¯æœ€å¤§å­—ç¬¦æ•°
    maxMessagesInHistory: 20, // å†å²æ¶ˆæ¯æœ€å¤§æ¡æ•°
  },
};
```

## ğŸ“ æ—¥å¿—æ–‡ä»¶

### `logs/usage.log` - ä½¿ç”¨è®°å½•

è®°å½•æ‰€æœ‰è¯·æ±‚å’Œæ¯æ—¥ç»Ÿè®¡æ‘˜è¦

### `logs/suspicious.log` - å¯ç–‘æ´»åŠ¨

è®°å½•è¢«æ‹¦æˆªçš„è¯·æ±‚å’Œå¼‚å¸¸è¡Œä¸º

### `logs/error.*.log` - é”™è¯¯æ—¥å¿—

è®°å½•ç³»ç»Ÿé”™è¯¯å’Œå¼‚å¸¸

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒå»ºè®®

### 1. æ·»åŠ ç®¡ç†æ¥å£è®¤è¯

```javascript
// åœ¨ router.js ä¸­æ·»åŠ è®¤è¯ä¸­é—´ä»¶
router.get("/admin/stats", authMiddleware, admin.getStats);
```

### 2. æ›´ä¸¥æ ¼çš„é™åˆ¶

```bash
NODE_ENV=production npm start
```

ç”Ÿäº§æ¨¡å¼ä¼šè‡ªåŠ¨åº”ç”¨æ›´ä¸¥æ ¼çš„é™åˆ¶ï¼š

- æ¯åˆ†é’Ÿæœ€å¤š 5 ä¸ªè¯·æ±‚
- å°é”æ—¶é•¿ 30 åˆ†é’Ÿ
- æ›´çŸ­çš„æ¶ˆæ¯é•¿åº¦é™åˆ¶

### 3. é…ç½® HTTPS

ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SSL/TLS åŠ å¯†

### 4. ä½¿ç”¨åå‘ä»£ç†

æ¨èä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†ï¼Œæä¾›é¢å¤–çš„å®‰å…¨å±‚

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### æ­£å¸¸è¯·æ±‚

```bash
curl -X POST http://localhost:3000/chatMessage \
  -H "Content-Type: application/json" \
  -d '{"chatMessage":[{"role":"user","content":"Hello"}]}'
```

### è§¦å‘é¢‘ç‡é™åˆ¶

```bash
for i in {1..15}; do
  curl -X POST http://localhost:3000/chatMessage \
    -H "Content-Type: application/json" \
    -d '{"chatMessage":[{"role":"user","content":"test"}]}'
  echo "Request $i"
done
```

## ğŸ“ˆ ç›‘æ§å»ºè®®

1. **æ¯å¤©æ£€æŸ¥æ—¥å¿—**

   ```bash
   tail -f logs/usage.log
   tail -f logs/suspicious.log
   ```

2. **ç›‘æ§æ¯æ—¥ç»Ÿè®¡**

   - æŸ¥çœ‹ Token ä½¿ç”¨è¶‹åŠ¿
   - è¯†åˆ«å¼‚å¸¸æµé‡æ¨¡å¼

3. **æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´**
   - å¦‚æœæ­£å¸¸ç”¨æˆ·è¢«è¯¯å°ï¼Œé€‚å½“æ”¾å®½é™åˆ¶
   - å¦‚æœå‘ç°æ»¥ç”¨ï¼Œæ”¶ç´§é™åˆ¶

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ­£å¸¸ç”¨æˆ·è¢«å°é”äº†ï¼Ÿ

A: å¯èƒ½æ˜¯é™åˆ¶å¤ªä¸¥æ ¼ã€‚ä½¿ç”¨ç®¡ç†æ¥å£è°ƒæ•´ `maxRequests` å‚æ•°ï¼š

```bash
curl -X POST http://localhost:3000/admin/config \
  -H "Content-Type: application/json" \
  -d '{"maxRequests": 20}'
```

### Q: å¦‚ä½•æŸ¥çœ‹æ˜¯å“ªä¸ª IP åœ¨æ»¥ç”¨ï¼Ÿ

A: æŸ¥çœ‹ `logs/suspicious.log` æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†æ‰€æœ‰è¢«æ‹¦æˆªçš„è¯·æ±‚

### Q: æœåŠ¡å™¨é‡å¯åå°é”è®°å½•ä¼šä¸¢å¤±å—ï¼Ÿ

A: æ˜¯çš„ï¼Œå½“å‰å°é”è®°å½•ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚é‡å¯åä¼šæ¸…ç©ºã€‚å¦‚éœ€æŒä¹…åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ•°æ®åº“ã€‚

### Q: å¦‚ä½•å®Œå…¨ç¦ç”¨æŸäº›é™åˆ¶ï¼Ÿ

A: ç¼–è¾‘ `config/security.config.js`ï¼Œè®¾ç½®éå¸¸é«˜çš„é™åˆ¶å€¼ï¼Œæˆ–è€…åœ¨ `app.js` ä¸­æ³¨é‡Šæ‰ç›¸åº”çš„ä¸­é—´ä»¶ã€‚

## ğŸ¯ æ•ˆæœé¢„æœŸ

å®æ–½è¿™äº›å®‰å…¨æªæ–½åï¼Œä½ å¯ä»¥ï¼š

âœ… é˜²æ­¢å•ä¸ª IP å¿«é€Ÿåˆ·è¯·æ±‚  
âœ… æ‹’ç»è¶…é•¿æ¶ˆæ¯ï¼ŒèŠ‚çœ Token  
âœ… æ£€æµ‹å¹¶é˜»æ­¢åƒåœ¾å†…å®¹  
âœ… å®æ—¶ç›‘æ§ API ä½¿ç”¨é‡  
âœ… å¿«é€Ÿå“åº”å¼‚å¸¸æµé‡  
âœ… è‡ªåŠ¨ä¿æŠ¤ DeepSeek ä½™é¢

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: `SECURITY.md`

---

**æœ€åæ›´æ–°**: 2025-10-07
